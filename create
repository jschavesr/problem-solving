#!/bin/sh

source scripts/sh/color.sh

Lang="go"
Problem=""
ConfigFile=config

LanguageGiven="false"
SetLanguage() {
  if [ "$LanguageGiven" = "true" ]; then
    EchoError "Language given multiple times, but it must be given at most once."
    exit 1
  else
    Lang="$1"
  fi
  LanguageGiven="true"
}


while [ $# -gt 0 ]; do
  case "$1" in
    -h|--help)
      SetInfoColor
      cat "scripts/docs/create-manual.txt"
      exit 0
      ;;

    -l|--lang)
      shift
      SetLanguage "$1"
      shift
      ;;

    *)
      if [ -z "$Problem" ]; then
        Problem="$1"
        shift
      else
        EchoError "Could not parse argument: $1"
        exit 1
      fi
      ;;
  esac
done

if ! echo "$Lang" | grep -Eq "^cpp|go$" ; then
  EchoError "Invalid language $Lang"
  exit 1
fi

if [ -d "workspace/$Problem" ]
then
	EchoError "Directory workspace/$Problem already exists"
	exit 1
fi

mkdir -p "workspace/$Problem/cases"

cp "notebook/$Lang/template.$Lang" "workspace/$Problem/main.$Lang"
touch "workspace/$Problem/cases/0.in"
touch "workspace/$Problem/cases/0.out"

code "workspace/$Problem/main.$Lang"
code "workspace/$Problem/cases/0.in"
code "workspace/$Problem/cases/0.out"

echo "Lang=$Lang" > "$ConfigFile"
echo "Problem=$Problem" >> "$ConfigFile"
echo "CaseId=0" >> "$ConfigFile"
